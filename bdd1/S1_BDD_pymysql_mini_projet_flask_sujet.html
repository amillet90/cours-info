<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>BDD1</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="markdown-pandoc-amV4.css" />
  <link rel="icon" href="favicon.ico" />
  <title>BDD</title>
</head>
<body>
<p><strong>Mini-Projet sur flask</strong></p>
<p>Utiliser votre mini-projet réalisé en tp de “Développement d’interfaces web” (pas avec les tableaux “articles/type_articles”). Vous avez tous un sujet différent.<br />
Ce code contient toutes les interfaces pour ajouter/afficher/modifier/supprimer (CRUD) des enregistrements dans 2 tables : ces 2 tables sont affichées sous forme de tableau.</p>
<h1 id="livrable">livrable</h1>
<ul>
<li>Mettre votre projet dans un dossier qui porte comme nom : <strong>GROUPE_nom</strong> (votre numéro de groupe suivi du nom du référent du groupe, exemple “A1_millet”)</li>
<li>Archiver votre projet (le nom de l’archive doit être le nom du projet) avec une extension .zip ou .tar.gz (pas de format microsoft)</li>
</ul>
<p>Ce dossier doit contenir un fichier de nom “sql_projet.sql”, ce fichier est votre script sql à jour pour supprimer, créer toutes les tables dans l’ordre puis insérer dans le bon ordre des enregistrements (un jeu de test). Ce dossier doit contenir votre application : un fichier app.py, un dossier “templates” et “static”, éventuellement un script shell pour lancer l’application. (pas de dossier venv)<br />
</p>
<p>Votre application doit être fonctionnelle sur une machine de l’IUT avec la commande “python app.py” dans un environnement local où les paquets “pymysql” et “flask” sont installés.<br />
</p>
<p>En remplaçant le login et le motDePasse des instructions ci-dessous par votre login et mot de passe sur le serveur mysql de l’iut, les 2 commandes ci-dessous doivent fonctionner pour tester votre application (dans un terminal ouvert dans votre dossier de projet) :</p>
<pre><code>mysql --user=login  --password=motDePasse --host=serveurmysql --database=BDD_login &lt; sql_projet.sql
python app.py</code></pre>
<p>Remarque : pour les travaux faits sur les machines personnelles, attention au mode par défaut <a href="https://stackoverflow.com/questions/34115174/error-related-to-only-full-group-by-when-executing-a-query-in-mysql"><strong>only_full_group_by</strong> (post 182 )</a> sur les machines de l’IUT. <br></p>
<p>Ajouter dans votre projet <a href="https://cours-info.iut-bm.univ-fcomte.fr/upload/perso/77/rs_S1_BDD/bdd1/source/eval_etudiant_mini_projet.xlsx">le petit fichier excel (utiliser ce lien)</a> en remplissant vos nom, prenom, groupe et en mettant des “1” si vous pensez que les parties sont pleinement réalisées.<br />
Ne pas renommer ce fichier, et l’enregistrer dans le même dossier que le fichier “app.py” et que le fichier “sql_projet.sql”</p>
<p><br></p>
<h1 id="script-sql"><strong>script SQL :</strong></h1>
<p><br></p>
<p>Réaliser un script SQL de nom <strong>sql_projet.sql</strong> pour :</p>
<ul>
<li>supprimer les 2 tables</li>
<li>créer les 2 tables (avec une <strong>contrainte d’intégrité référentielle</strong> sur la clé étrangère)</li>
<li>ajouter les enregistrements (une instruction INSERT par enregistrement)</li>
<li>supprimer la <strong>contrainte d’intégrité référentielle</strong> sur la clé étrangère</li>
<li>re-créer la contrainte sur la clé étrangère</li>
<li>réaliser une requête avec une/des fonction(s) d’agrégation et une jointure entre les 2 tables de type (LEFT ou RIGHT JOIN)</li>
<li>proposer un exemple de requête préparée pour modifier un enregistrement - <a href="https://fromdual.com/mariadb-prepared-statements-transactions-and-multi-row-inserts" target="_blanck">exemple de requête préparée</a></li>
</ul>
<p><br></p>
<p>Vous pouvez modifier la composition des tables <strong>en ajoutant une date ou un attribut de type texte avec une image</strong>. Utiliser du <a href="https://fr.wikipedia.org/wiki/Snake_case" target="_blanck">snake_case</a> pour les noms des tables et des attributs.</p>
<p><br></p>
<h1 id="crud-sur-2-tables"><strong>CRUD sur 2 tables</strong></h1>
<p><br></p>
<h2 id="afficher-les-tables">afficher les tables</h2>
<p>Ces 2 tables sont affichées sous forme de tableau.</p>
<p><br></p>
<p>Lors de l’affichage de la plus “petite” des 2 tables :</p>
<ul>
<li><strong>afficher le nombre d’enregistrements ayant une dépendance fonctionnelle avec cette table (en rouge sur l’exemple)</strong></li>
<li>afficher en première colonne celle qui définie le mieux l’enregistrement pour l’utilisateur et trier par cet enregistrement</li>
</ul>
<figure>
<img src="img_flask/sql_flask_projet_img_1.png" style="width:18cm" alt="" /><figcaption>exemple pour les types d’article, le nombre d’articles ayant une dépendance fonctionnelle avec ce type</figcaption>
</figure>
<p>Lors de l’affichage de la plus “grosse” des 2 tables :</p>
<ul>
<li><strong>afficher en plus de la clé étrangère, la valeur de la colonne de l’autre table qui définie le mieux cet enregistrement(en rouge sur l’exemple)</strong></li>
<li>afficher en première colonne celle qui définie le mieux l’enregistrement pour l’utilisateur et trier par cet enregistrement</li>
</ul>
<figure>
<img src="img_flask/sql_flask_projet_img_2.png" style="width:18cm" alt="" /><figcaption>exemple pour les articles, le libellé du type d’article</figcaption>
</figure>
<h2 id="ajouter-et-modifier-un-enregistrement">ajouter et modifier un enregistrement</h2>
<p>Lors de l’ajout d’un enregistrement dans la plus grosse des tables</p>
<ul>
<li>utiliser une liste déroulante pour renseigner la clé étrangère avec comme contenu les valeurs de la clé primaire pour respecter <strong>la contrainte d’intégrité référentielle</strong></li>
<li>trier le champ qui vous parait le plus pertinent pour identifier la valeur de la clé étrangère pour l’utilisateur dans le contenu de la liste déroulante</li>
<li>pas de valeur sélectionnée pour l’utilisateur lorsque l’on ajoute un enregistrement dans la liste déroulante</li>
</ul>
<figure>
<img src="img_flask/sql_flask_projet_img_3.png" style="width:10cm" alt="" /><figcaption>exemple de liste déroulante pour ajouter</figcaption>
</figure>
<ul>
<li>lors de la modification d’un enregistrement, les 2 formulaires contiennent les valeurs de l’enregistrement édité (pour les 2 tables)</li>
<li>la liste déroulante qui correspond à la clé étrangère dans une des tables doit être fonctionnelle</li>
<li>la bonne valeur de la clé est sélectionnée dans la liste déroulante</li>
</ul>
<p><br></p>
<figure>
<img src="img_flask/sql_flask_projet_img_4.png" style="width:10cm" alt="" /><figcaption>exemple de liste déroulante pour modifier</figcaption>
</figure>
<h1 id="supprimer-un-enregistrement">supprimer un enregistrement</h1>
<p>Lors de la suppression d’un enregistrement sur la plus petite des tables. Tester si aucune clé étrangère dans l’autre table utilise la clé primaire de l’enregistrement à supprimer. Si c’est le cas proposer des liens pour supprimer les enregistrements en cascade de l’autre table.</p>
<figure>
<img src="img_flask/sql_flask_projet_img_7.png" style="width:10cm" alt="" /><figcaption>exemple de liens pour supprimer en cascade</figcaption>
</figure>
<p><strong>Le plus compliqué est de conserver l’interface pour supprimer (voir sur l’exemple)</strong></p>
<h1 id="état">État</h1>
<ul>
<li>un état ; utiliser une/des fonctions d’agrégation, éventuellement des jointures</li>
</ul>
<figure>
<img src="img_flask/sql_flask_projet_img_5.png" style="width:18cm" alt="" /><figcaption>exemple d’état</figcaption>
</figure>
<p><strong>Faire au moins 2 requêtes pour l’état :</strong><br />
</p>
<ul>
<li>une requête qui fait des calculs sur tous les enregistrements de la première table</li>
<li>une requête qui fait des calculs sur chaque groupe d’enregistrements de la seconde table et qui affiche le résultat sous forme de tableau</li>
</ul>
<p><br></p>
<h1 id="interfaces-supplémentaires">Interfaces supplémentaires</h1>
<ul>
<li><strong>Interface supplémentaire avec un filtre</strong> : une des tables est affichée sous forme de checkBox, l’autre est affichée sous forme de “cards”, lorsque des éléments sont sélectionnés dans les “checkbox”, ils sont conservés en mémoire et seuls les éléments (cards) de l’autre table qui correspondent sont affichés (si on effectue d’autres opérations et que l’on revient sur cette interface, les éléments restent filtrés)</li>
</ul>
<figure>
<img src="img_flask/sql_flask_projet_img_8.png" style="width:18cm" alt="" /><figcaption>exemple de filtre</figcaption>
</figure>
<p><br></p>
<h1 id="mette-en-ligne-votre-application.">Mette en ligne votre application.</h1>
<p><br></p>
<p>Pour mettre en ligne votre application, utiliser</p>
<ul>
<li>Utiliser <a href="https://www.pythonanywhere.com/" class="uri">https://www.pythonanywhere.com/</a>,</li>
</ul>
<!-- https://www.younup.fr/blog/heroku-pour-deployer-votre-application-python-flask-dans-le-cloud 
https://stackabuse.com/deploying-a-flask-application-to-heroku/
https://realpython.com/flask-by-example-part-1-project-setup/
https://openclassrooms.com/fr/courses/4425066-concevez-un-site-avec-flask/4526644-deployez-efficacement-sur-le-cloud-avec-heroku
-->
<h1 id="annexe-test-de-lapplication">annexe : test de l’application</h1>
<p><span class="modif">script de test du projet :</span> <br></p>
<p><span class="modif">Un premier script extrait les archives <code>.tar.gz</code> et <code>.zip</code>, ce script recherche un dossier et copie un autre script <code>test_projet.sh</code> dans le dossier, le script se trouve au même niveau que le fichier app.py (une erreur est signalée dans le cas contraire).</span></p>
<p><br></p>
<p>script de test <code>test_projet.sh</code>:</p>
<pre><code>#!/bin/bash

# mysql --user=login --password=secret --host=localhost BDD_s1_projet

HOST=localhost
LOGIN=login
PASSWORD=secret
DATABASE=BDD_s1_projet

sed -i &quot;s/host=.*/host=\&quot;${HOST}\&quot;,/g&quot; app.py
sed -i &quot;s/user=.*/user=\&quot;${LOGIN}\&quot;,/g&quot; app.py
sed -i &quot;s/password=.*/password=\&quot;${PASSWORD}\&quot;,/g&quot; app.py
sed -i &quot;s/database=.*/database=\&quot;${DATABASE}\&quot;,/g&quot; app.py

projet=$(ls -l sql_projet.sql)
if [ $? -ne 0 ]
    then
    echo -e &quot;\033[0;31m \n* pas de fichier sql_projet.sql \033[0m&quot;
    nb_fic_sql=$(ls -l *.sql | wc -l)
    if [ &quot;${nb_fic_sql}&quot; -eq &quot;1&quot; ]
    then
        NOM_FIC_SQL=$(echo *.sql)
        cp &quot;$NOM_FIC_SQL&quot; sql_projet.sql
        echo -e &quot;\033[0;32m \n* fichier copier $NOM_FIC_SQL sql_projet.sql \033[0m&quot;
    else
        echo -e &quot;\033[0;31m \n* pas de fichier ****.sql \033[0m&quot;
        exit 2
    fi  
fi

echo &quot;DROP DATABASE  IF EXISTS ${DATABASE}; CREATE DATABASE ${DATABASE};&quot; | mysql --user=${LOGIN} --password=${PASSWORD} --host=${HOST} ${DATABASE}
mysql --user=${LOGIN} --password=${PASSWORD} --host=${HOST} ${DATABASE} &lt; sql_projet.sql

echo &quot;mysql --user=${LOGIN} --password=${PASSWORD} --host=${HOST} ${DATABASE}&quot; &gt; connect.sh
chmod a+x connect.sh
gnome-terminal --tab -- ./connect.sh  &amp;

xed sql_projet.sql app.py &amp;

killall python3
flask --debug  --app app  run   --host 0.0.0.0  &amp;
chromium 127.0.0.1:5000</code></pre>
</body>
</html>
