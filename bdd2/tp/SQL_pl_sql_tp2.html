<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>BDD</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="markdown-pandoc-amV4.css" />
  <link rel="icon" href="favicon.ico" />
  <title>BDD</title>
</head>
<body>
<h1 id="présentation">présentation</h1>
<p>Le problème ci-dessous s’inspire du problème sur Oracle du TP suivant : <a href="http://www-bd.lip6.fr/wiki/site/enseignement/licence/2i009/documents-tme/tme-plsql" target="_blanck">http://www-bd.lip6.fr/wiki/site/enseignement/licence/2i009/documents-tme/tme-plsql</a> <br></p>
<p>Nous travaillerons par la suite sur les trois tables suivantes qui permettent de décrire des employés, des projets, l’affectation des employés aux projets et les grilles de salaire pour différents profils de postes :</p>
<p><strong>EMPLOYE(<span class="underline">NumSS</span>, NomE, PrenomE, VilleE, DateNaiss)</strong><br />
<strong>PROJET(<span class="underline">NumProj</span>, NomProj, <em>#iRespProj</em>,, VilleP, Budget)</strong><br />
<strong>EMBAUCHE(#<em><span class="underline">NumSS,#NumProj</span></em>, DateEmb, Profil)</strong><br />
<strong>GRILLE_SAL(<span class="underline">Profil</span>, Salaire)</strong></p>
<p>La clé primaire de chaque table est soulignée.</p>
<ol type="1">
<li><span class="orange">Déssiner le MCD sur Looping de ce MLD</span></li>
</ol>
<ul>
<li>Rappels : Pour exécuter une procédure dans PL-SQL sur MySQL ou MariaDB, utilisez la commande: <code>CALL nom_procedure(liste_paramètres)</code></li>
</ul>
<ol start="2" type="1">
<li><p><span class="orange">utilisez <a href="https://chat.openai.com/">ChatGPT</a> ou <a href="https://bard.google.com/">Bard</a> pour donner la commande equivalente sur MySQL.</span></p></li>
<li><p><span class="orange">existe t’il un équivalent de <code>SHOW err</code></span></p></li>
</ol>
<h1 id="constitution-de-la-base-de-données">CONSTITUTION DE LA BASE DE DONNÉES</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">create</span> <span class="kw">table</span> Employe( </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a> NumSS <span class="dt">number</span>(<span class="dv">5</span>) , </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a> NomE <span class="dt">varchar2</span>(<span class="dv">20</span>) ,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a> PrenomE <span class="dt">varchar2</span>(<span class="dv">20</span>) , </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a> VilleE <span class="dt">varchar2</span>(<span class="dv">20</span>) , </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a> DateNaiss <span class="dt">date</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>); </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="kw">create</span> <span class="kw">table</span> Projet( </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a> NumProj <span class="dt">Number</span>(<span class="dv">3</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a> NomProj <span class="dt">varchar2</span>(<span class="dv">20</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a> RespProj <span class="dt">number</span>, </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a> VilleP <span class="dt">varchar2</span>(<span class="dv">20</span>), </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a> Budget <span class="dt">number</span> </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>); </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="kw">create</span> <span class="kw">table</span> Grille_sal( </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a> profil <span class="dt">varchar2</span>(<span class="dv">20</span>), </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a> salaire <span class="dt">number</span>(<span class="dv">7</span>,<span class="dv">2</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>); </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="kw">create</span> <span class="kw">table</span> Embauche( </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a> NumSS <span class="dt">number</span> ,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a> NumProj <span class="dt">number</span> , </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a> DateEmb <span class="dt">date</span> <span class="kw">default</span> <span class="fu">sysdate</span>, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a> Profil <span class="dt">varchar2</span>(<span class="dv">20</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>);</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Employe (NumSS, NomE, PrenomE, VilleE, DateNaiss)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a><span class="kw">values</span> (</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>(<span class="dv">22334</span>, <span class="st">&#39;Adam&#39;</span>, <span class="st">&#39;Funk&#39;</span>, <span class="st">&#39;Paris&#39;</span>,   <span class="st">&#39;1-12-1982&#39;</span>  ),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>(<span class="dv">45566</span>, <span class="st">&#39;Rachid&#39;</span>, <span class="st">&#39;Allaoui&#39;</span>, <span class="st">&#39;Lyon&#39;</span>,   <span class="st">&#39;13-4-1986&#39;</span>  ),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>(<span class="dv">77889</span>, <span class="st">&#39;Florent&#39;</span>, <span class="st">&#39;Girac&#39;</span> , <span class="st">&#39;Marseille&#39;</span>,   <span class="st">&#39;4-11-1990&#39;</span>  ),</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>(<span class="dv">90011</span>, <span class="st">&#39;Mayla&#39;</span>, <span class="st">&#39;Aoun&#39;</span>, <span class="st">&#39;Lyon&#39;</span>,   <span class="st">&#39;26-3-1987&#39;</span>  ),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>(<span class="dv">22233</span>, <span class="st">&#39;Christine&#39;</span>, <span class="st">&#39;Lara&#39;</span>, <span class="st">&#39;Paris&#39;</span>,   <span class="st">&#39;9-8-1982&#39;</span>  ),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>(<span class="dv">34445</span>, <span class="st">&#39;Amel&#39;</span>, <span class="st">&#39;Orlando&#39;</span>, <span class="st">&#39;Lyon&#39;</span>,   <span class="st">&#39;14-2-1976&#39;</span>  ),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>(<span class="dv">55666</span>, <span class="st">&#39;Mohsen&#39;</span>, <span class="st">&#39;Charef&#39;</span>, <span class="st">&#39;Paris&#39;</span>,   <span class="st">&#39;28-5-1991&#39;</span>  ),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>(<span class="dv">77788</span>, <span class="st">&#39;Tim&#39;</span>, <span class="st">&#39;Arabi&#39;</span>, <span class="st">&#39;Marseille&#39;</span>,   <span class="st">&#39;8-6-1984&#39;</span>  ),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a>(<span class="dv">89990</span>, <span class="st">&#39;Fernando&#39;</span>, <span class="st">&#39;Lopez&#39;</span>, <span class="st">&#39;Lyon&#39;</span>,   <span class="st">&#39;5-10-1993&#39;</span>  ),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>(<span class="dv">11122</span>, <span class="st">&#39;Ada&#39;</span>,<span class="st">&#39;Tan Lee&#39;</span>, <span class="st">&#39;Marseille&#39;</span>,   <span class="st">&#39;21-3-1994&#39;</span>  ),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a>(<span class="dv">11123</span>, <span class="st">&#39;Franck&#39;</span>, <span class="st">&#39;Morel&#39;</span>, <span class="st">&#39;Lille&#39;</span>,   <span class="st">&#39;10-01-1945&#39;</span>  ),</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>);</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Projet <span class="kw">values</span> (<span class="dv">123</span>, <span class="st">&#39;ADOOP&#39;</span>, <span class="dv">22334</span>, <span class="st">&#39;Paris&#39;</span>, <span class="dv">120000</span>);</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Projet <span class="kw">values</span> (<span class="dv">757</span>, <span class="st">&#39;SKALA&#39;</span>, <span class="dv">45566</span>, <span class="st">&#39;Lyon&#39;</span>, <span class="dv">180000</span>);</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Projet <span class="kw">values</span> (<span class="dv">890</span>, <span class="st">&#39;BAJA&#39;</span>, <span class="dv">22334</span>, <span class="st">&#39;Paris&#39;</span>, <span class="dv">24000</span>);</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> grille_sal <span class="kw">values</span> (<span class="st">&#39;Admin&#39;</span>, <span class="dv">80000</span>);</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> grille_sal <span class="kw">values</span> (<span class="st">&#39;Deve&#39;</span>, <span class="dv">45000</span>);</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> grille_sal <span class="kw">values</span> (<span class="st">&#39;Tech&#39;</span>, <span class="dv">35000</span>);</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Embauche <span class="kw">values</span> (<span class="dv">77889</span>, <span class="dv">123</span>,   <span class="st">&#39;1-3-2014&#39;</span>  ,<span class="st">&#39;Deve&#39;</span>);</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Embauche <span class="kw">values</span> (<span class="dv">90011</span>, <span class="dv">123</span>,   <span class="st">&#39;1-5-2014&#39;</span>  ,<span class="st">&#39;Tech&#39;</span>);</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a><span class="kw">insert</span> <span class="kw">into</span> Embauche <span class="kw">values</span> (<span class="dv">22233</span>, <span class="dv">757</span>,   <span class="st">&#39;1-3-2014&#39;</span>  ,<span class="st">&#39;Deve&#39;</span>);</span></code></pre></div>
<ol start="4" type="1">
<li><span class="orange">Utiliser une IA générative (réaliser un prompt) pour modifier le script ci-dessus :</span></li>
</ol>
<ul>
<li>ajouter les clés primaires</li>
<li>ajouter les clés étrangéres</li>
<li>modifier le type des colonnes pour qu’il soit compatible sur MySQL</li>
<li>ajouter la fonction <code>STR_TO_DATE</code>(‘1-01-2012’, ‘%d-%m-%Y’), utiliser rechercher/remplacer (CTRL R ou CTRL H)</li>
</ul>
<details>
<summary>💡 exemple de solution proposer par l’IA générative </summary>
<p>
<pre><code>CREATE TABLE Employe (
    NumSS INT(5) PRIMARY KEY,
    NomE VARCHAR(20),
    PrenomE VARCHAR(20),
    VilleE VARCHAR(20),
    DateNaiss DATE
);

CREATE TABLE Projet (
    NumProj INT(3) PRIMARY KEY,
    NomProj VARCHAR(20),
    RespProj INT,
    VilleP VARCHAR(20),
    Budget DECIMAL(10,2),
    FOREIGN KEY (RespProj) REFERENCES Employe(NumSS)
);

CREATE TABLE Grille_sal (
    profil VARCHAR(20) PRIMARY KEY,
    salaire DECIMAL(7,2)
);

CREATE TABLE Embauche (
    NumSS INT,
    NumProj INT,
    DateEmb DATE DEFAULT CURRENT_DATE,
    Profil VARCHAR(20),
    PRIMARY KEY (NumSS, NumProj, DateEmb),
    FOREIGN KEY (NumSS) REFERENCES Employe(NumSS),
    FOREIGN KEY (NumProj) REFERENCES Projet(NumProj),
    FOREIGN KEY (Profil) REFERENCES Grille_sal(profil)
);

INSERT INTO Employe (NumSS, NomE, PrenomE, VilleE, DateNaiss)
VALUES
(22334, &#39;Adam&#39;, &#39;Funk&#39;, &#39;Paris&#39;, STR_TO_DATE(&#39;01-12-1982&#39;, &#39;%d-%m-%Y&#39;)),
(45566, &#39;Rachid&#39;, &#39;Allaoui&#39;, &#39;Lyon&#39;, STR_TO_DATE(&#39;13-04-1986&#39;, &#39;%d-%m-%Y&#39;)),
(77889, &#39;Florent&#39;, &#39;Girac&#39;, &#39;Marseille&#39;, STR_TO_DATE(&#39;04-11-1990&#39;, &#39;%d-%m-%Y&#39;)),
(90011, &#39;Mayla&#39;, &#39;Aoun&#39;, &#39;Lyon&#39;, STR_TO_DATE(&#39;26-03-1987&#39;, &#39;%d-%m-%Y&#39;)),
(22233, &#39;Christine&#39;, &#39;Lara&#39;, &#39;Paris&#39;, STR_TO_DATE(&#39;09-08-1982&#39;, &#39;%d-%m-%Y&#39;)),
(34445, &#39;Amel&#39;, &#39;Orlando&#39;, &#39;Lyon&#39;, STR_TO_DATE(&#39;14-02-1976&#39;, &#39;%d-%m-%Y&#39;)),
(55666, &#39;Mohsen&#39;, &#39;Charef&#39;, &#39;Paris&#39;, STR_TO_DATE(&#39;28-05-1991&#39;, &#39;%d-%m-%Y&#39;)),
(77788, &#39;Tim&#39;, &#39;Arabi&#39;, &#39;Marseille&#39;, STR_TO_DATE(&#39;08-06-1984&#39;, &#39;%d-%m-%Y&#39;)),
(89990, &#39;Fernando&#39;, &#39;Lopez&#39;, &#39;Lyon&#39;, STR_TO_DATE(&#39;05-10-1993&#39;, &#39;%d-%m-%Y&#39;)),
(11122, &#39;Ada&#39;, &#39;Tan Lee&#39;, &#39;Marseille&#39;, STR_TO_DATE(&#39;21-03-1994&#39;, &#39;%d-%m-%Y&#39;)),
(11123, &#39;Franck&#39;, &#39;Morel&#39;, &#39;Lille&#39;, STR_TO_DATE(&#39;10-01-1945&#39;, &#39;%d-%m-%Y&#39;));

INSERT INTO Projet VALUES (123, &#39;ADOOP&#39;, 22334, &#39;Paris&#39;, 120000);
INSERT INTO Projet VALUES (757, &#39;SKALA&#39;, 45566, &#39;Lyon&#39;, 180000);
INSERT INTO Projet VALUES (890, &#39;BAJA&#39;, 22334, &#39;Paris&#39;, 24000);

INSERT INTO Grille_sal VALUES (&#39;Admin&#39;, 80000);
INSERT INTO Grille_sal VALUES (&#39;Deve&#39;, 45000);
INSERT INTO Grille_sal VALUES (&#39;Tech&#39;, 35000);

INSERT INTO Embauche VALUES (77889, 123, STR_TO_DATE(&#39;01-03-2014&#39;, &#39;%d-%m-%Y&#39;), &#39;Deve&#39;);
INSERT INTO Embauche VALUES (90011, 123, STR_TO_DATE(&#39;01-05-2014&#39;, &#39;%d-%m-%Y&#39;), &#39;Tech&#39;);
INSERT INTO Embauche VALUES (22233, 757, STR_TO_DATE(&#39;01-03-2014&#39;, &#39;%d-%m-%Y&#39;), &#39;Deve&#39;);
</code></pre>
<p>
</details>
<ol start="5" type="1">
<li><span class="orange">Utiliser une IA générative (réaliser un prompt) pour modifier la procédure PL-SQL ci-dessus :</span></li>
</ol>
<pre><code>DECLARE 
    trouve BOOLEAN;
BEGIN
   FOR  r  IN (SELECT numproj, nomproj, villep FROM Projet ORDER BY nomproj)
    LOOP
             dbms_output.put_line(&#39;-----------------------------------&#39;);
             dbms_output.put_line(&#39;Projet: &#39;||r.nomproj||&#39; dans la ville  &#39;||r.villep);
             dbms_output.put_line(&#39;-----------------------------------&#39;);
                       trouve := FALSE;
                       FOR r2 IN (SELECT nome, prenome FROM employe e, embauche b 
                                      WHERE e.numss=b.numss AND b.numproj=r.numproj )
                       LOOP
                            dbms_output.put_line(&#39;Employé: &#39;|| r2.nome||&#39;, &#39;|| r2.prenome);
                            trouve := TRUE;
                      END LOOP;
                      IF(trouve = FALSE) THEN
                            dbms_output.put_line(&#39;Pas d&#39;&#39;employé&#39;);
                       END IF;
    END LOOP;
END;</code></pre>
<p>le résultat de l’instruction <code>CALL AfficherProjetsEmployes();</code> dans un terminal connecté à MySQL avec le jeu de test donné est :</p>
<pre><code>MariaDB [BDD_s2_tp]&gt; CALL AfficherProjetsEmployes2();
+-------------------------------------+
| Ligne                               |
+-------------------------------------+
| ----------------------------------- |
| Projet: ADOOP dans la ville Paris   |
| ----------------------------------- |
| Employé: Florent, Girac             |
| Employé: Mayla, Aoun                |
| ----------------------------------- |
| Projet: BAJA dans la ville Paris    |
| ----------------------------------- |
| ----------------------------------- |
| Projet: SKALA dans la ville Lyon    |
| ----------------------------------- |
| Employé: Christine, Lara            |
+-------------------------------------+
12 rows in set (0,006 sec)

Query OK, 12 rows affected (0,006 sec)
</code></pre>
<p><br> <br> <br></p>
<ol start="2" type="1">
<li><span class="orange">Exo 2 (Curseur Implicite). Écrivez un bloc PL/SQL anonyme qui supprime tous les employés de la table EMPLOYE qui ont 70 ans ou plus et qui affiche le nombre de lignes qui ont été supprimées ou le message ‘Aucun employé supprimé’ si aucun employé n’a plus de 70 ans. Utilisez les attributs d’un curseur implicite.</span></li>
</ol>
<pre><code>MariaDB [BDD_s2_tp]&gt; CALL SupprimerEmployes70ansOuPlus();
+-----------------------------+
| Message                     |
+-----------------------------+
| 1 employé(s) supprimé(s).   |
+-----------------------------+
1 row in set (0,004 sec)</code></pre>
<p>L’instruction <code>SELECT * FROM Employe;</code> permet de voir que franck a disparu</p>
<ol start="3" type="1">
<li><span class="orange">Exo3 (Curseur). Écrivez un bloc PL/SQL anonyme qui modifie tous les noms des profils dans la table grille_sal en ajoutant la lettre ‘P’ devant chaque nom de profil. Pour chaque profil modifié dans la table grille_sal les valeurs correspondantes dans la table embauche doivent également être modifiées. Utilisez un curseur.</span></li>
</ol>
<pre><code>MariaDB [BDD_s2_tp]&gt; SELECT profil, salaire
    -&gt;         FROM Grille_sal;
+--------+----------+
| profil | salaire  |
+--------+----------+
| Admin  | 80000.00 |
| Deve   | 45000.00 |
| Tech   | 35000.00 |
+--------+----------+
3 rows in set (0,001 sec)

MariaDB [BDD_s2_tp]&gt; SHOW CREATE TABLE Embauche;
+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Embauche | CREATE TABLE `Embauche` (
  `NumSS` int(11) NOT NULL,
  `NumProj` int(11) NOT NULL,
  `DateEmb` date NOT NULL DEFAULT curdate(),
  `Profil` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`NumSS`,`NumProj`,`DateEmb`),
  KEY `NumProj` (`NumProj`),
  KEY `Profil` (`Profil`),
  CONSTRAINT `Embauche_ibfk_1` FOREIGN KEY (`NumSS`) REFERENCES `Employe` (`NumSS`),
  CONSTRAINT `Embauche_ibfk_2` FOREIGN KEY (`NumProj`) REFERENCES `Projet` (`NumProj`),
  CONSTRAINT `Embauche_ibfk_3` FOREIGN KEY (`Profil`) REFERENCES `Grille_sal` (`profil`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci |
+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0,000 sec)

MariaDB [BDD_s2_tp]&gt; CALL ModifierProfilsEtSalaire();
+-----------------------------------------------+  
| Message                                       |
+-----------------------------------------------+
| Les profils ont été modifiés avec succès.     |
+-----------------------------------------------+
1 row in set (0,568 sec)

Query OK, 12 rows affected (0,568 sec)

MariaDB [BDD_s2_tp]&gt; SELECT profil, salaire
    -&gt;         FROM Grille_sal;
+--------+----------+
| profil | salaire  |
+--------+----------+
| PAdmin | 80000.00 |
| PDeve  | 45000.00 |
| PTech  | 35000.00 |
+--------+----------+
3 rows in set (0,001 sec)</code></pre>
<ol start="4" type="1">
<li><span class="orange">(Curseur avec des paramètres) Écrivez un bloc PL/SQL anonyme qui affiche tous les noms de projet, pour chaque nom de projet on affiche les noms des employés affectés à ce projet. Utiliser un curseur avec des paramètres.</span></li>
</ol>
<p>voir question 1</p>
<ol start="5" type="1">
<li><span class="orange">(Utilisation CASE et Curseur)Écrire un bloc anonyme qui augmente tous les salaires dans la table Grille_Sal. Les salaires inférieurs à 40000 sont augmentés de 30%, les salaires compris entre 40000 et 60000 de 20% et les salaires supérieurs à 60000 sont augmentés de 10%. Utilisez un CASE pour tester les différentes valeurs possibles du salaire.</span></li>
</ol>
<pre><code>MariaDB [BDD_s2_tp]&gt; SELECT profil, salaire
    -&gt;         FROM Grille_sal;
+--------+----------+
| profil | salaire  |
+--------+----------+
| PAdmin | 80000.00 |
| PDeve  | 45000.00 |
| PTech  | 35000.00 |
+--------+----------+
3 rows in set (0,001 sec)

MariaDB [BDD_s2_tp]&gt; CALL AugmenterSalaires();
+-------------------------------------------------+
| Message                                         |
+-------------------------------------------------+
| Les salaires ont été augmentés avec succès.     |
+-------------------------------------------------+
1 row in set (0,010 sec)

Query OK, 3 rows affected (0,010 sec)

MariaDB [BDD_s2_tp]&gt; SELECT profil, salaire
    -&gt;         FROM Grille_sal;
+--------+----------+
| profil | salaire  |
+--------+----------+
| PAdmin | 88000.00 |
| PDeve  | 54000.00 |
| PTech  | 45500.00 |
+--------+----------+
3 rows in set (0,001 sec)

MariaDB [BDD_s2_tp]&gt; 
</code></pre>
<ol start="6" type="1">
<li><span class="orange">(Exception prédéfinie) Écrire une procédure PL/SQL qui a 3 paramètres: le numSS, le nomE et prenomE d’un nouvel employé à insérer dans la table Employé. S’il existe déjà un autre employé avec le même numSS dans la table Employé elle doit afficher un message d’erreur sans insérer l’utilisateur. Dans le cas contraire la procédure doit insérer le nouvel employé et afficher un message de confirmation. Utilisez l’exception prédéfinie NO_DATA_FOUND.</span></li>
</ol>
<pre><code>SELECT profil, salaire  FROM Grille_sal;
CALL AugmenterSalaires();
SELECT profil, salaire  FROM Grille_sal;</code></pre>
<ol start="7" type="1">
<li><span class="orange">(Exception utilisateur) Écrire une procédure qui prend comme paramètre le numéro et le budget d’un projet et qui l’ajoute à la table projet seulement si la somme tous les budgets après l’ajout ne dépasse pas 400000. Dans le cas contraire le projet n’est pas ajouté et un message d’erreur est affiché à l’utilisateur. Utilisez une exception utilisateur.</span></li>
</ol>
<pre><code>CALL InsererNouvelEmploye(1234567, &#39;Alain&#39;, &#39;Paul&#39;);
SELECT *  FROM Employe;
CALL InsererNouvelEmploye(22334, &#39;Adam&#39;, &#39;Funk&#39;);</code></pre>
<h1 id="utilisation-des-procédures-dans-un-script-python">utilisation des procédures dans un script python</h1>
<p><span class="orange">Proposer une exemple de programme python qui utilise la dernière procédure</span></p>
<pre><code>
import pymysql

# Connexion à la base de données MySQL
conn = pymysql.connect(
    host=&quot;votre_hôte&quot;,
    user=&quot;votre_utilisateur&quot;,
    password=&quot;votre_mot_de_passe&quot;,
    database=&quot;votre_base_de_données&quot;,
    port=3306  # Remplacez par le port MySQL utilisé dans votre configuration
)

try:
    # Création d&#39;un curseur
    cursor = conn.cursor()

    # Exécution de la procédure stockée
    num_ss = 123456789
    nom_e = &quot;Doe&quot;
    prenom_e = &quot;John&quot;
    cursor.callproc(&quot;NomDeVotreProcedureMySQL&quot;, (num_ss, nom_e, prenom_e))

    # Commit pour valider les modifications
    conn.commit()

    # Affichage du résultat ou de tout message renvoyé par la procédure
    result = cursor.fetchall()
    print(result)

except pymysql.Error as e:
    # Récupération du message d&#39;erreur
    error_message = e.args[1]
    print(f&quot;Erreur MySQL: {error_message}&quot;)

finally:
    # Fermeture du curseur et de la connexion
    cursor.close()
    conn.close()
</code></pre>
<ul>
<li><span class="orange">afficher le resultat de la requête ainsi que le message d’erreur</span></li>
<li><span class="orange">essayer de modifier le message d’erreur</span></li>
</ul>
<p><a href="https://www.w3schools.com/python/python_try_except.asp" class="uri">https://www.w3schools.com/python/python_try_except.asp</a></p>
</body>
</html>
