<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>BDD</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="markdown-pandoc-amV4.css" />
  <link rel="icon" href="favicon.ico" />
  <title>BDD</title>
</head>
<body>
<p>Avec la base de données suivantes :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> article (</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    id_article <span class="dt">INT</span> AUTO_INCREMENT</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    , designation <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    , prix <span class="dt">NUMERIC</span>(<span class="dv">19</span>,<span class="dv">4</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    , stock <span class="dt">INT</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    , <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_article)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>)<span class="dt">CHARACTER</span> <span class="kw">SET</span> <span class="st">&#39;utf8mb4&#39;</span> ;           </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> client (</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>    id_client <span class="dt">INT</span> AUTO_INCREMENT</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    , nom <span class="dt">VARCHAR</span>(<span class="dv">25</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    , ville <span class="dt">VARCHAR</span>(<span class="dv">25</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    , <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_client)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>)<span class="dt">CHARACTER</span> <span class="kw">SET</span> <span class="st">&#39;utf8mb4&#39;</span>;           </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span>  commande (</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>    id_commande <span class="dt">INT</span> AUTO_INCREMENT</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>    , date_commande <span class="dt">DATE</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>    , id_client <span class="dt">INT</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>    , <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_commande)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>    , <span class="kw">CONSTRAINT</span> fk_commande_client <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (id_client) <span class="kw">REFERENCES</span> client(id_client)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>)<span class="dt">CHARACTER</span> <span class="kw">SET</span> <span class="st">&#39;utf8mb4&#39;</span>;             </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> ligne (</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>    id_commande <span class="dt">INT</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>    , id_article <span class="dt">INT</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>    , quantite <span class="dt">INT</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>    , <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_commande,id_article)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>    , <span class="kw">CONSTRAINT</span> fk_ligne_commande <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (id_commande) <span class="kw">REFERENCES</span> commande(id_commande)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>    , <span class="kw">CONSTRAINT</span> fk_ligne_article <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (id_article) <span class="kw">REFERENCES</span> article(id_article)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>);</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> panier (</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>    id_client <span class="dt">INT</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>    , id_article <span class="dt">INT</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>    , quantite <span class="dt">INT</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>    , <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_client,id_article)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>    , <span class="kw">CONSTRAINT</span> fk_panier_client <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (id_client) <span class="kw">REFERENCES</span> client(id_client)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>    , <span class="kw">CONSTRAINT</span> fk_panier_article <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (id_article) <span class="kw">REFERENCES</span> article(id_article)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>);</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> client <span class="kw">VALUES</span> (<span class="dv">1</span>,<span class="st">&#39;Mutz&#39;</span>,<span class="st">&#39;Ruelisheim&#39;</span>),(<span class="dv">2</span>,<span class="st">&#39;Rato&#39;</span>,<span class="st">&#39;Besancon&#39;</span>),(<span class="dv">3</span>,<span class="st">&#39;Goerig&#39;</span>,<span class="st">&#39;Walheim&#39;</span>),(<span class="dv">4</span>,<span class="st">&#39;Walter&#39;</span>,<span class="st">&#39;Bretten&#39;</span>),(<span class="dv">5</span>,<span class="st">&#39;PAUTOT&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">6</span>,<span class="st">&#39;PETIT&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">7</span>,<span class="st">&#39;SAINT DIZIER&#39;</span>,<span class="st">&#39;Sevenans&#39;</span>),(<span class="dv">8</span>,<span class="st">&#39;SALVI&#39;</span>,<span class="st">&#39;Offemont&#39;</span>),(<span class="dv">9</span>,<span class="st">&#39;TERRAT&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">10</span>,<span class="st">&#39;TYRODE&#39;</span>,<span class="st">&#39;Valdoie&#39;</span>),(<span class="dv">11</span>,<span class="st">&#39;ALANKAYA&#39;</span>,<span class="st">&#39;Bavilliers&#39;</span>),(<span class="dv">12</span>,<span class="st">&#39;DAROSEY&#39;</span>,<span class="st">&#39;Essert&#39;</span>),(<span class="dv">13</span>,<span class="st">&#39;duguet&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">14</span>,<span class="st">&#39;ESSENBURGER&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">15</span>,<span class="st">&#39;JAOUEN&#39;</span>,<span class="st">&#39;Sevenans&#39;</span>),(<span class="dv">16</span>,<span class="st">&#39;molin&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">17</span>,<span class="st">&#39;AMGHAR&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">18</span>,<span class="st">&#39;BOUCHAUD&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">19</span>,<span class="st">&#39;COTTARD&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">20</span>,<span class="st">&#39;LAMOTTE&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">21</span>,<span class="st">&#39;METTEY&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">22</span>,<span class="st">&#39;WOLF&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">23</span>,<span class="st">&#39;BISMUTH&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">24</span>,<span class="st">&#39;chaillet&#39;</span>,<span class="st">&#39;Belfort&#39;</span>),(<span class="dv">25</span>,<span class="st">&#39;DECOCK&#39;</span>,<span class="st">&#39;Belfort&#39;</span>);</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> article <span class="kw">VALUES</span> </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>(<span class="dv">1</span>,<span class="st">&#39;Gâteaux chocolat ( pâtisserie)&#39;</span>,<span class="fl">5.25</span>,<span class="dv">10</span>),(<span class="dv">2</span>,<span class="st">&#39;gâteau fraise (pâtisserie) &#39;</span>,<span class="fl">5.25</span>,<span class="dv">10</span>),(<span class="dv">3</span>,<span class="st">&#39;Mouchoir ( hygiène)&#39;</span>,<span class="fl">2.54</span>,<span class="dv">10</span>),(<span class="dv">4</span>,<span class="st">&#39;Coca cola ( boisson )&#39;</span>,<span class="fl">1.52</span>,<span class="dv">10</span>),(<span class="dv">5</span>,<span class="st">&#39;Salade ( légume ) &#39;</span>,<span class="fl">2.00</span>,<span class="dv">10</span>),(<span class="dv">6</span>,<span class="st">&#39;Choux ( légume ) &#39;</span>,<span class="fl">2.50</span>,<span class="dv">10</span>),(<span class="dv">7</span>,<span class="st">&#39;Pomme de terre ( légume ) &#39;</span>,<span class="fl">1.50</span>,<span class="dv">10</span>),(<span class="dv">8</span>,<span class="st">&#39;Tomate ( légume ) &#39;</span>,<span class="fl">1.50</span>,<span class="dv">10</span>),(<span class="dv">9</span>,<span class="st">&#39;Haricot ( légume ) &#39;</span>,<span class="fl">6.50</span>,<span class="dv">10</span>),(<span class="dv">10</span>,<span class="st">&#39;Potiron ( légume ) &#39;</span>,<span class="fl">3.00</span>,<span class="dv">10</span>),(<span class="dv">11</span>,<span class="st">&#39;Poireau ( légume ) &#39;</span>,<span class="fl">1.50</span>,<span class="dv">10</span>),(<span class="dv">12</span>,<span class="st">&#39;Fenouil ( légume ) &#39;</span>,<span class="fl">3.00</span>,<span class="dv">10</span>),(<span class="dv">13</span>,<span class="st">&#39;Pissenlit ( légume ) &#39;</span>,<span class="fl">5.00</span>,<span class="dv">10</span>),(<span class="dv">14</span>,<span class="st">&#39;Petit pois ( légume ) &#39;</span>,<span class="fl">6.00</span>,<span class="dv">10</span>),(<span class="dv">15</span>,<span class="st">&#39;Poivron ( légume ) &#39;</span>,<span class="fl">3.00</span>,<span class="dv">10</span>),(<span class="dv">16</span>,<span class="st">&#39;Radis ( légume ) &#39;</span>,<span class="fl">2.00</span>,<span class="dv">10</span>),(<span class="dv">17</span>,<span class="st">&#39;Pomme ( fruit ) &#39;</span>,<span class="fl">3.00</span>,<span class="dv">10</span>),(<span class="dv">18</span>,<span class="st">&#39;Perrier ( 1L eau ) &#39;</span>,<span class="fl">1.50</span>,<span class="dv">10</span>),(<span class="dv">19</span>,<span class="st">&#39;Vittel ( 1L eau ) &#39;</span>,<span class="fl">1.00</span>,<span class="dv">10</span>);</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> commande <span class="kw">VALUES</span> </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>(<span class="dv">1</span>,<span class="st">&#39;2023-04-11&#39;</span>,<span class="dv">3</span>),</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>(<span class="dv">2</span>,<span class="st">&#39;2023-12-11&#39;</span>,<span class="dv">2</span>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>(<span class="dv">3</span>,<span class="st">&#39;2024-01-28&#39;</span>,<span class="dv">4</span>),</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>(<span class="dv">4</span>,<span class="st">&#39;2023-09-19&#39;</span>,<span class="dv">1</span>),</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>(<span class="dv">5</span>,<span class="st">&#39;2019-04-11&#39;</span>,<span class="dv">3</span>),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>(<span class="dv">6</span>,<span class="st">&#39;2023-12-11&#39;</span>,<span class="dv">2</span>),</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>(<span class="dv">7</span>,<span class="st">&#39;2023-03-28&#39;</span>,<span class="dv">4</span>),</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a>(<span class="dv">8</span>,<span class="st">&#39;2023-12-09&#39;</span>,<span class="dv">1</span>),</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a>(<span class="dv">9</span>,<span class="st">&#39;2022-04-11&#39;</span>,<span class="dv">3</span>),</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>(<span class="dv">10</span>,<span class="st">&#39;2023-12-11&#39;</span>,<span class="dv">2</span>);</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> ligne <span class="kw">VALUES</span> </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">12</span>),(<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">4</span>),(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">4</span>),(<span class="dv">1</span>,<span class="dv">15</span>,<span class="dv">4</span>),</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">6</span>),(<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">6</span>),(<span class="dv">2</span>,<span class="dv">14</span>,<span class="dv">6</span>),</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>),(<span class="dv">3</span>,<span class="dv">11</span>,<span class="dv">3</span>),(<span class="dv">3</span>,<span class="dv">12</span>,<span class="dv">3</span>),(<span class="dv">3</span>,<span class="dv">16</span>,<span class="dv">3</span>),</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">27</span>),(<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">5</span>),(<span class="dv">4</span>,<span class="dv">10</span>,<span class="dv">5</span>),(<span class="dv">4</span>,<span class="dv">17</span>,<span class="dv">5</span>),</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a>(<span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">4</span>),</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">3</span>),</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">5</span>),</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a>(<span class="dv">8</span>,<span class="dv">14</span>,<span class="dv">6</span>);</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> panier <span class="kw">VALUES</span> </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">4</span>),(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">4</span>),</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>),(<span class="dv">2</span>,<span class="dv">19</span>,<span class="dv">4</span>),</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a>(<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">4</span>),(<span class="dv">3</span>,<span class="dv">17</span>,<span class="dv">4</span>),</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>),(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">4</span>),(<span class="dv">4</span>,<span class="dv">17</span>,<span class="dv">4</span>),(<span class="dv">4</span>,<span class="dv">19</span>,<span class="dv">4</span>),</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>),(<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">4</span>),(<span class="dv">5</span>,<span class="dv">17</span>,<span class="dv">4</span>),(<span class="dv">5</span>,<span class="dv">19</span>,<span class="dv">4</span>),</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>),(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">4</span>),(<span class="dv">6</span>,<span class="dv">17</span>,<span class="dv">4</span>),(<span class="dv">6</span>,<span class="dv">19</span>,<span class="dv">4</span>)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a>;</span></code></pre></div>
<h1 id="exercice-1">exercice 1</h1>
<p>Créer une procédure sur le SGBDR MySQL en PL/SQL qui reçoit en paramètre un identifiant de client, cette procédure permet de :</p>
<ul>
<li><p>Créer un enregistrement dans la table commande avec comme date la date d’aujourd’hui et comme identifiant de client le paramètre passé.</p></li>
<li><p>Recopiez les enregistrements de la table “panier” ayant pour identifiant client l’identifiant client passé en paramètre dans la table ligne avec comme identifiant de commande celui de l’enregistrement créé précédemment.</p>
<ul>
<li>Pour cette partie, il est demandé d’utiliser un curseur (qui sélectionne tous les enregistrements de la table “panier” ayant pour identifiant client l’identifiant client passé en paramètre) et une boucle qui crée un enregistrement pour chaque valeur de ce curseur. Dans votre boucle, utilisez un “WHILE”.</li>
<li>Testez une autre solution sans curseur <a href="https://www.w3schools.com/sql/sql_insert_into_select.asp" class="uri">https://www.w3schools.com/sql/sql_insert_into_select.asp</a></li>
</ul></li>
</ul>
<p>Pour tester cette procédure, utiliser la commande suivante :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co">-- test exercice 1 </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">SET</span> @id_client<span class="op">=</span><span class="dv">3</span>;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> panier <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> commande <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="kw">CALL</span> creer_commande(@id_client);</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> panier <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> commande <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(id_commande) <span class="kw">INTO</span> @id_commande</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>  <span class="kw">FROM</span> commande;</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> ligne <span class="kw">WHERE</span> id_commande<span class="op">=</span>@id_commande;</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="kw">SET</span> @id_client<span class="op">=</span><span class="dv">1</span>;                              </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> panier <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> commande <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a><span class="kw">CALL</span> creer_commande(@id_client);       <span class="co">-- commande 1</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> panier <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> commande <span class="kw">WHERE</span> id_client<span class="op">=</span>@id_client;</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(id_commande) <span class="kw">INTO</span> @id_commande</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>  <span class="kw">FROM</span> commande;</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> ligne <span class="kw">WHERE</span> id_commande<span class="op">=</span>@id_commande;</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a><span class="co">-- test exercice 2 </span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="kw">CALL</span> creer_commande(@id_client);    <span class="co">-- commande 2</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(id_commande) <span class="kw">INTO</span> @id_commande</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>  <span class="kw">FROM</span> commande;</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> ligne <span class="kw">WHERE</span> id_commande<span class="op">=</span>@id_commande;</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a>    c.id_commande, c.date_commande, cl.nom <span class="kw">AS</span> client_nom, cl.ville <span class="kw">AS</span> client_ville,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a>    a.id_article, a.designation, l.quantite, a.prix, a.stock</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true"></a>commande c <span class="kw">JOIN</span>    client cl <span class="kw">ON</span> c.id_client <span class="op">=</span> cl.id_client</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span>     ligne l <span class="kw">ON</span> c.id_commande <span class="op">=</span> l.id_commande</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span>     article a <span class="kw">ON</span> l.id_article <span class="op">=</span> a.id_article</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true"></a><span class="kw">WHERE</span>     c.id_client <span class="op">=</span> @id_client</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span>     c.date_commande, c.id_commande, l.id_article;</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> panier(id_client, id_article, quantite) <span class="kw">VALUES</span>     <span class="co">-- article quantité non suffisante</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true"></a>(@id_client,<span class="dv">7</span>,<span class="dv">14</span>),(@id_client,<span class="dv">17</span>,<span class="dv">4</span>)    ;</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true"></a><span class="kw">CALL</span> creer_commande(@id_client);  <span class="co">-- commande 3</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true"></a>    c.id_commande, c.date_commande, cl.nom <span class="kw">AS</span> client_nom, cl.ville <span class="kw">AS</span> client_ville,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true"></a>    a.id_article, a.designation, l.quantite, a.prix, a.stock</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true"></a><span class="kw">FROM</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true"></a>commande c <span class="kw">JOIN</span>    client cl <span class="kw">ON</span> c.id_client <span class="op">=</span> cl.id_client</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span>     ligne l <span class="kw">ON</span> c.id_commande <span class="op">=</span> l.id_commande</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span>     article a <span class="kw">ON</span> l.id_article <span class="op">=</span> a.id_article</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true"></a><span class="kw">WHERE</span>     c.id_client <span class="op">=</span> @id_client</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span>     c.date_commande, c.id_commande, l.id_article;</span></code></pre></div>
<h1 id="exercice-2">exercice 2</h1>
<p>En testant, le SQL ci-dessus, on voit que la procédure PL/SQL autorise des commandes sans articles et que le stock n’est pas gérer ; modifier votre script pour éviter ce problème.</p>
<ul>
<li><p>Dans votre script :</p></li>
<li><p>Tester</p></li>
<li><p>Ajouter une transaction</p></li>
<li><p>Vérifiez si le curseur sur la table “panier” retourne des lignes et générez une erreur si ce n’est pas le cas.</p></li>
<li><p>Si le stock de produit n’est pas suffisant,</p>
<ul>
<li>faire une levée d’exeption et retourner un message d’erreur. Toutes les opérations sont annulées (rollback).</li>
</ul></li>
<li><p>Sinon</p>
<ul>
<li>décrémenter le stock de produit.</li>
</ul></li>
</ul>
<h1 id="exercice-3">exercice 3</h1>
<ul>
<li>Faire un script python qui teste cette procédure PL/SQL. Le script python affiche que tout s’est bien passé ou l’erreur et son code.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>```python</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="co">#! /usr/bin/python</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co"># -*- coding:utf-8 -*-</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="im">import</span> pymysql</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="im">import</span> sys</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="co"># Vérifier que le script a reçu le bon nombre d&#39;arguments</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="cf">if</span> <span class="bu">len</span>(sys.argv) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;Usage: python script.py &lt;num_client&gt;&quot;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>    sys.exit(<span class="dv">1</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="co"># Connexion à la base de données MySQL</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>conn <span class="op">=</span> pymysql.<span class="ex">connect</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>    host<span class="op">=</span><span class="st">&quot;votre_hôte&quot;</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>    user<span class="op">=</span><span class="st">&quot;votre_utilisateur&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>    password<span class="op">=</span><span class="st">&quot;votre_mot_de_passe&quot;</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a>    database<span class="op">=</span><span class="st">&quot;votre_base_de_données&quot;</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>    port<span class="op">=</span><span class="dv">3306</span>  <span class="co"># Remplacez par le port MySQL utilisé dans votre configuration</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="cf">try</span>:</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a>    <span class="co"># Création d un curseur</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a>    cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a>    <span class="co"># Exécution de la procédure stockée</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a>    num_client <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">1</span>])</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a>    num_ss <span class="op">=</span> <span class="dv">123456789</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>    nom_e <span class="op">=</span> <span class="st">&quot;Doe&quot;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>    prenom_e <span class="op">=</span> <span class="st">&quot;John&quot;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true"></a>    cursor.callproc(<span class="st">&quot;NomDeVotreProcedureMySQL&quot;</span>, (num_ss, nom_e, prenom_e))</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true"></a>    <span class="co"># Commit pour valider les modifications</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true"></a>    conn.commit()</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true"></a>    <span class="co"># Affichage du résultat ou de tout message renvoyé par la procédure</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true"></a>    result <span class="op">=</span> cursor.fetchall()</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true"></a>    <span class="bu">print</span>(result)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true"></a><span class="cf">except</span> pymysql.Error <span class="im">as</span> e:</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true"></a>    <span class="co"># Récupération du message d erreur</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true"></a>    <span class="bu">print</span>(e)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true"></a>    error_message <span class="op">=</span> e.args[<span class="dv">1</span>]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Erreur MySQL: </span><span class="sc">{</span>error_message<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true"></a><span class="cf">finally</span>:</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true"></a>    <span class="co"># Fermeture du curseur et de la connexion</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true"></a>    cursor.close()</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true"></a>    conn.close()</span></code></pre></div>
<p>Exemple de résultat dans un terminal :</p>
<pre><code>$ python script_python_exo3.py 3
(1644, &quot;Stock insuffisant pour l&#39;article avec id 7 avec comme stock 6&quot;)
Erreur MySQL: Stock insuffisant pour l&#39;article avec id 7 avec comme stock 6</code></pre>
<h1 id="exercice-4">exercice 4</h1>
<p>Créez des triggers (déclencheurs) sur la table panier. Ces triggers lorsque l’on crée/supprime/modifie un enregistrement dans la table panier met à jour le stock dans la table article. (le stock ne peut pas être négatif).</p>
<p>Dans ce cas, la mise à jour du stock dans la procédure PL/SQL précédente n’a plus de sens (il faut la retirer).</p>
</body>
</html>
