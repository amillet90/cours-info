<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>BDD</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="markdown-pandoc-amV4.css" />
  <link rel="icon" href="favicon.ico" />
  <title>BDD</title>
</head>
<body>
<h1 id="fonctions-sql">Fonctions SQL</h1>
<p>Sur les différents SGBD, il y a une multitude de fonctions :</p>
<ul>
<li><a href="http://sqlpro.developpez.com/cours/sqlaz/fonctions/" target="_blanck">liste de fonctions</a></li>
<li><a href="http://fadace.developpez.com/sgbdcmp/fonctions/" target="_blanck">les fonctions sur les différents SGBD</a></li>
</ul>
<p>« Enseigner, ce n’est pas remplir un vase, c’est allumer un feu » Une phrase qui ne date pas d’hier puisqu’elle est de Montaigne …</p>
<p>L’objectif n’est pas de les voir toutes mais d’en utiliser certaines (si possible les plus pertinentes), pour voir les différences entre SGBD et en retenir quelques une.</p>
<h2 id="fonction-sur-les-dates">fonction sur les dates</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">SELECT</span> CURDATE();     <span class="co">--  fonction sur MYSQL (juste la date)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">SELECT</span> GETDATE();     <span class="co">-- fonction transactSQL de SQLSERVER</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="fu">SYSDATE</span>();     <span class="co">-- fonction sur ORACLE</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="fu">CURRENT_TIMESTAMP</span>;   <span class="co">-- norme SQL  : fonction &quot;système&quot; pas de  paramètres </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="co">-- (fonctionne sur MYSQL et PostGreSQL , mais pas sur ORACLE et SQLSERVER)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">SELECT</span> NOW();    <span class="co">--  fonction sur MYSQL (date+heure)</span></span></code></pre></div>
<ol type="1">
<li><p>Quelles sont les fonctions pour obtenir la date d’aujourd’hui sur les principaux SGBDR ?</p></li>
<li><p>Indiquer si ces fonctions tiennent compte du fuseau horaire et le format de la date retournée.</p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> TD_telephone;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> TD_telephone </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>idTelephone       <span class="dt">INTEGER</span> AUTO_INCREMENT  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>, type_id         <span class="dt">CHAR</span>(<span class="dv">2</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>, marque_id       <span class="dt">INTEGER</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>, date_achat   <span class="dt">DATE</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>, prix         <span class="dt">DECIMAL</span> (<span class="dv">9</span>,<span class="dv">2</span>)       <span class="co">/* NUMBER(9,2) sur ORACLE */</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>, proprietaire_id <span class="dt">INTEGER</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>, couleur       <span class="dt">VARCHAR</span>(<span class="dv">25</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>, <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(idTelephone)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>);</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_telephone (idTelephone,type_id,marque_id,date_achat,prix,proprietaire_id,couleur) <span class="kw">VALUES</span> (<span class="dv">1</span>,<span class="st">&#39;SP&#39;</span> ,<span class="dv">1</span>,STR_TO_DATE(<span class="st">&#39;15/01/2020&#39;</span>, <span class="st">&#39;%d/%m/%Y&#39;</span>),<span class="fl">139.99</span>,<span class="dv">190120</span>,<span class="st">&#39;ROUGE&#39;</span>);</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a><span class="co">-- il est déconseillé de mettre une valeur à une clé primaire =&gt; pour vérification</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_telephone (idTelephone,type_id,marque_id,date_achat,prix,proprietaire_id) <span class="kw">VALUES</span> (<span class="kw">NULL</span>,<span class="st">&#39;SP&#39;</span> ,<span class="dv">2</span>,STR_TO_DATE(<span class="st">&#39;14/03/2020&#39;</span>, <span class="st">&#39;%d/%m/%Y&#39;</span>), <span class="fl">99.99</span>,<span class="dv">190215</span>);</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_telephone</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>(idTelephone,type_id,marque_id,date_achat,prix,proprietaire_id,couleur) <span class="kw">VALUES</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="st">&#39;CL&#39;</span> ,<span class="dv">3</span>,STR_TO_DATE(<span class="st">&#39;02/05/2020&#39;</span>, <span class="st">&#39;%d/%m/%Y&#39;</span>), <span class="fl">49.11</span>,<span class="dv">190001</span>,<span class="st">&#39;NOIR&#39;</span>);</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_telephone</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>(idTelephone,type_id,marque_id,date_achat,prix,proprietaire_id,couleur) <span class="kw">VALUES</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="st">&#39;CO&#39;</span> ,<span class="dv">4</span>,STR_TO_DATE(<span class="st">&#39;25/07/2020&#39;</span>, <span class="st">&#39;%d/%m/%Y&#39;</span>), <span class="fl">89.14</span>,<span class="dv">190222</span>,<span class="st">&#39;BLANC&#39;</span>);</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_telephone</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>(idTelephone,type_id,marque_id,date_achat,prix,proprietaire_id)         <span class="kw">VALUES</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="st">&#39;IP&#39;</span> ,<span class="dv">5</span>,STR_TO_DATE(<span class="st">&#39;30/09/2020&#39;</span>, <span class="st">&#39;%d/%m/%Y&#39;</span>),<span class="fl">359.49</span>,<span class="dv">190561</span>);</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_telephone</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a>(idTelephone,type_id,marque_id,date_achat,prix,proprietaire_id,couleur) <span class="kw">VALUES</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="st">&#39;CO&#39;</span> ,<span class="dv">5</span>,STR_TO_DATE(<span class="st">&#39;01/01/2021&#39;</span>, <span class="st">&#39;%d/%m/%Y&#39;</span>), <span class="fl">99.51</span>,<span class="dv">122120</span>,<span class="st">&#39;BLANC&#39;</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="st">&#39;SP&#39;</span> ,<span class="dv">1</span>,<span class="st">&#39;2013-01-15&#39;</span>,<span class="dv">189</span>,<span class="dv">190622</span>,<span class="st">&#39;ROUGE&#39;</span>),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="kw">NULL</span> ,<span class="kw">NULL</span>,<span class="st">&#39;2013-01-15&#39;</span>,<span class="dv">20</span>,<span class="dv">190623</span>,<span class="st">&#39;ROUGE&#39;</span>),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a>(<span class="kw">NULL</span>,<span class="kw">NULL</span> ,<span class="dv">1</span>,<span class="st">&#39;2013-01-15&#39;</span>,<span class="kw">NULL</span>,<span class="kw">NULL</span>,<span class="kw">NULL</span>);</span></code></pre></div>
<p>exemple :</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html" target="_blanck">DATEDIFF</a></li>
<li><a href="https://mariadb.com/kb/en/date-time-functions/" target="_blanck">DATEADD</a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co">-- MYSQL</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">SELECT</span> date_achat, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    <span class="dt">YEAR</span>(date_achat) <span class="kw">as</span> Annee,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    DATEDIFF(date_achat, CURDATE()) <span class="kw">as</span> <span class="ot">&quot;Difference&quot;</span> ,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>    DATE_ADD(date_achat, <span class="dt">INTERVAL</span> <span class="dv">30</span> <span class="dt">DAY</span>) <span class="kw">as</span> Plus30j ,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>    DATE_SUB(date_achat, <span class="dt">INTERVAL</span> <span class="dv">30</span> <span class="dt">DAY</span>) <span class="kw">as</span> Moins30j ,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>    DATE_ADD(date_achat, <span class="dt">INTERVAL</span> <span class="op">-</span><span class="dv">30</span> <span class="dt">DAY</span>) <span class="kw">as</span> Moins30j2    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="co">-- SQLSERVER</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span>, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>    <span class="dt">YEAR</span>(date_achat) <span class="kw">as</span> Annee,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>    DATEDIFF(<span class="dt">DAY</span>, date_achat, DateDemandee) <span class="kw">as</span> [Difference],</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>    DATEADD(<span class="dt">DAY</span>, <span class="dv">30</span>, date_achat) <span class="kw">as</span> Plus30j,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>    DATEADD(<span class="dt">DAY</span>, <span class="op">-</span><span class="dv">30</span>, date_achat) <span class="kw">as</span> Moins30j</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="co">-- ORACLE</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span>, </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>    <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> date_achat) <span class="kw">as</span> Annee,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>    DateDemandee <span class="op">-</span> date_achat <span class="kw">as</span> <span class="ot">&quot;Difference&quot;</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>    date_achat <span class="op">+</span> <span class="dv">30</span> <span class="kw">as</span> Plus30j,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a>    date_achat <span class="op">-</span> <span class="dv">30</span> <span class="kw">as</span> Moins30j</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone;</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a><span class="co">-- ADD_MONTHS(date_achat, 2)</span></span></code></pre></div>
<ul>
<li>fonction <a href="https://mariadb.com/kb/en/library/format/" target="_blanck">FORMAT</a></li>
</ul>
<h3 id="exemple-de-configuration-de-la-time_zone">exemple de configuration de la “time_zone”</h3>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/datetime.html" target="_blanck">documentation datetime timestamp</a> - <a href="https://planetscale.com/blog/datetimes-vs-timestamps-in-mysql" target="_blanck">limite</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> posts;</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> posts (</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>id_post  <span class="dt">INT</span>  AUTO_INCREMENT</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>, title <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>, content LONGTEXT</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>, <span class="kw">online</span> <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">DEFAULT</span> <span class="dv">0</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>, dt_created_at DATETIME  <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>, dt_updated_at DATETIME <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span> <span class="kw">ON</span> <span class="kw">UPDATE</span> <span class="fu">CURRENT_TIMESTAMP</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>, ts_created_at <span class="dt">TIMESTAMP</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>, ts_updated_at <span class="dt">TIMESTAMP</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_TIMESTAMP</span> <span class="kw">ON</span> <span class="kw">UPDATE</span> <span class="fu">CURRENT_TIMESTAMP</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>, <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_post)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>);</span></code></pre></div>
<p>Dans la documentation, beaucoup de synonymes :<br />
<a href="https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html" target="_blanck">https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html</a> <br></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts(title, <span class="kw">online</span>) <span class="kw">VALUES</span>(<span class="st">&#39;titre post1&#39;</span>, <span class="dv">0</span>);</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts(title, <span class="kw">online</span>) <span class="kw">VALUES</span>(<span class="st">&#39;titre post2&#39;</span>, <span class="dv">1</span>);</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts <span class="kw">SET</span> title<span class="op">=</span><span class="st">&#39;titre post3&#39;</span> , <span class="kw">online</span><span class="op">=</span><span class="dv">2</span>;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts <span class="kw">VALUES</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>(<span class="kw">NULL</span>, <span class="st">&#39;titre post4&#39;</span>, <span class="kw">NULL</span>, <span class="dv">0</span>, <span class="st">&#39;2023-01-01 12:00:00&#39;</span>, <span class="st">&#39;2023-01-01 12:00:00&#39;</span>, <span class="st">&#39;2023-01-01 12:00:00&#39;</span>, <span class="st">&#39;2023-01-01 12:00:00&#39;</span>);</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> posts;</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">UPDATE</span> posts <span class="kw">SET</span> title<span class="op">=</span><span class="st">&#39;titre post1 new&#39;</span> <span class="kw">WHERE</span> id_post<span class="op">=</span><span class="dv">1</span>;</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> posts;</span></code></pre></div>
<p>ATTENTION à la configuration (localisation) du serveur</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">SELECT</span> @@global.<span class="kw">time_zone</span>, @@session.<span class="kw">time_zone</span>;</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="kw">SET</span> <span class="kw">time_zone</span> <span class="op">=</span> <span class="st">&#39;+03:00&#39;</span>;</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="kw">SELECT</span> @@global.<span class="kw">time_zone</span>, @@session.<span class="kw">time_zone</span>;</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts(title, <span class="kw">online</span>) <span class="kw">VALUES</span>(<span class="st">&#39;titre post5&#39;</span>, <span class="dv">0</span>);</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts(title, <span class="kw">online</span>) <span class="kw">VALUES</span>(<span class="st">&#39;titre post6&#39;</span>, <span class="dv">1</span>);</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> posts;</span></code></pre></div>
<p>timestamp nombre de seconde depuis 1970</p>
<p>différence timezone timestamp(=&gt; sauvegarde au format UTC)</p>
<p><br></p>
<p>date au format <strong>UTC (temps universel)</strong> : UTC_TIMESTAMP() n’est pas affecté par les fuseaux horaires locaux, ce qui le rend utile pour les scénarios dans lesquels une mesure cohérente du temps est requise sur différents emplacements.</p>
<pre><code>SELECT UTC_TIMESTAMP,UTC_TIMESTAMP();
SELECT UTC_TIMESTAMP()+0;</code></pre>
<p><strong>Pour connaitre la configuation du serveur</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">SELECT</span> @@global.<span class="kw">time_zone</span>, @@session.<span class="kw">time_zone</span>;</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="kw">SELECT</span> TIMEDIFF(NOW(), CONVERT_TZ(NOW(),  @@session.<span class="kw">time_zone</span>, <span class="st">&#39;+00:00&#39;</span>));</span></code></pre></div>
<p>Documentation UTC :</p>
<p><a href="https://fr.wikipedia.org/wiki/Temps_universel_coordonn%C3%A9" target="_blanck">https://fr.wikipedia.org/wiki/Temps_universel_coordonn%C3%A9</a> : calcul du temps UTC <br></p>
<figure>
<img src="img/BDD2_td4_img1.png" style="width:15cm" alt="" /><figcaption>sur pythonanywhere (AWS en angleterre)</figcaption>
</figure>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts <span class="kw">VALUES</span>(<span class="kw">NULL</span>, <span class="st">&#39;titre post7&#39;</span>, <span class="kw">NULL</span>, <span class="dv">0</span>, NOW(), NOW(), NOW(), NOW() );</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts <span class="kw">VALUES</span>(<span class="kw">NULL</span>, <span class="st">&#39;titre post8&#39;</span>, <span class="kw">NULL</span>,<span class="dv">1</span>, <span class="fu">CURRENT_TIMESTAMP</span>(), <span class="fu">CURRENT_TIMESTAMP</span>() , <span class="fu">CURRENT_TIMESTAMP</span>(), <span class="fu">CURRENT_TIMESTAMP</span>());</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> posts <span class="kw">VALUES</span>(<span class="kw">NULL</span>, <span class="st">&#39;titre post9&#39;</span>, <span class="kw">NULL</span>, <span class="dv">0</span>, <span class="st">&#39;2023-03-29 12:00:00&#39;</span>, <span class="st">&#39;2023-03-29 12:00:00&#39;</span>, <span class="st">&#39;2023-03-29 12:00:00&#39;</span>, <span class="st">&#39;2023-03-29 12:00:00&#39;</span>);</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> posts;</span></code></pre></div>
<p><br></p>
<p>Il existe beaucoup de fonctions : <a href="https://zestedesavoir.com/tutoriels/730/administrez-vos-bases-de-donnees-avec-mysql/951_fonctions-manipuler-les-dates/3950_calculs-sur-les-donnees-temporelles/" target="_blanck">exemple de fonctions</a></p>
<h2 id="fonction-sur-les-chaînes-de-caractères">fonction sur les chaînes de caractères</h2>
<ul>
<li>les fonctions sur les chaînes de caractères <a href="https://dev.mysql.com/doc/refman/5.7/en/string-functions.html">MySQL</a> <a href="https://mariadb.com/kb/en/library/string-functions/" target="_blanck">mariaDB</a></li>
</ul>
<p>Exemple : Avec une table et un champ composé du nom et du prénom (pas d’espace dans le nom) récupérer le nom et le prénom des personnes</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="co">-- MYSQL</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="kw">SELECT</span> libelle,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>    <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>    <span class="kw">LEFT</span>(libelle, <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>)<span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>    SUBSTRING(libelle, <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>)<span class="op">+</span> <span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    <span class="fu">LTRIM</span>(SUBSTRING(libelle, <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>), <span class="dv">100</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a><span class="kw">FROM</span> TD_marque_tel;</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a><span class="co">-- SQL SERVER</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a><span class="kw">SELECT</span> libelle,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>    CHARINDEX(<span class="st">&#39; &#39;</span>, libelle),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    <span class="kw">LEFT</span>(libelle, CHARINDEX(<span class="st">&#39; &#39;</span>, libelle) <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    SUBSTRING(libelle, CHARINDEX(<span class="st">&#39; &#39;</span>, libelle) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>    <span class="fu">LTRIM</span>(SUBSTRING(libelle, CHARINDEX(<span class="st">&#39; &#39;</span>, libelle), <span class="dv">100</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a><span class="kw">FROM</span> TD_marque_tel;</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a><span class="co">-- ORACLE</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a><span class="kw">SELECT</span> libelle,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a>    <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a>    <span class="fu">SUBSTR</span>(libelle, <span class="dv">1</span>, <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>)<span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a>    <span class="fu">SUBSTR</span>(libelle, <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>)<span class="op">+</span> <span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a>    <span class="fu">TRIM</span>(<span class="fu">SUBSTR</span>(libelle, <span class="fu">INSTR</span>(libelle, <span class="st">&#39; &#39;</span>), <span class="dv">100</span>))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a><span class="kw">FROM</span> TD_marque_tel;</span></code></pre></div>
<h2 id="fonctions-sur-les-numériques">fonctions sur les numériques</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co">-- pour SQL Server et MySQL</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">SELECT</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>    idTelephone</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>    , idTelephone <span class="op">/</span> <span class="dv">2</span>   <span class="co">-- attention au trans-typage CAST</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>    , prix</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>    , <span class="fu">COALESCE</span>(prix, <span class="dv">0</span>) <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>    , CEILING(prix)          <span class="co">-- CEIL sur ORACLE</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>    , <span class="fu">FLOOR</span>(prix)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>    , <span class="fu">ROUND</span>(prix, <span class="dv">1</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone;</span></code></pre></div>
<ul>
<li>La fonction <em>FORMAT</em> fonctionne comme <em>ROUND</em> mais retourne une chaîne de caractères (attention au tri)</li>
</ul>
<h1 id="select-avancé">SELECT avancé</h1>
<h2 id="efficacité-de-la-clause-where">efficacité de la clause WHERE</h2>
<ul>
<li><p>dateTime : attention à l’heure dans un BETWEEN (ne pas perdre la dernière valeur), pour une valeur entre 2 dates (pour la deuxième date, l’heure vaut 00:00:00)</p></li>
<li><p>Si c’est possible : Ne pas utiliser des fonctions compliquées sur des colonnes dans le WHERE =&gt; Augmente beaucoup le temps d’exécution des requêtes</p></li>
</ul>
<h2 id="in-et-between">IN et BETWEEN</h2>
<ul>
<li>augmente la lisibilité</li>
<li>penser au complément : NOT IN , NOT BEETWEEN</li>
</ul>
<h2 id="if">IF</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">SELECT</span> tel.prix <span class="kw">AS</span> PRIX</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>       , <span class="cf">IF</span>(tel.prix <span class="op">&lt;</span><span class="dv">99</span> ,<span class="ot">&quot;premier Prix&quot;</span>, <span class="cf">IF</span>(tel.prix<span class="op">&lt;</span><span class="dv">259</span>,<span class="ot">&quot;prix medium&quot;</span>,<span class="ot">&quot;prix élevé&quot;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone <span class="kw">AS</span> tel</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="kw">WHERE</span> tel.prix <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code></pre></div>
<h2 id="case">CASE</h2>
<ul>
<li>Comme le IF, cette fonction permet de créer un nouveau champ en fonction de la valeur d’un champ (colonne)</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">SELECT</span> tel.date_achat <span class="kw">AS</span> ACHAT</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>       , tel.type_id <span class="kw">AS</span> <span class="kw">type</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>       , tel.marque_id <span class="kw">AS</span> MARQUE</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>       , marq.libelle <span class="kw">AS</span> LIBELLE</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>       , <span class="cf">CASE</span> tel.marque_id</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>            <span class="cf">WHEN</span> <span class="dv">1</span> <span class="cf">THEN</span> <span class="st">&#39;MEILLEURS VENTES&#39;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>            <span class="cf">WHEN</span> <span class="dv">5</span> <span class="cf">THEN</span> <span class="st">&#39;Très bonnes ventes&#39;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>            <span class="cf">ELSE</span> <span class="st">&#39;AUTRES ventes&#39;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>        <span class="cf">END</span> <span class="kw">AS</span> type_de_vente</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone tel        </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a><span class="kw">INNER</span> <span class="kw">JOIN</span>  TD_marque_tel <span class="kw">AS</span> marq</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a>  <span class="kw">ON</span> tel.marque_id <span class="op">=</span> marq.idMarque ;</span></code></pre></div>
<ul>
<li>Avec des bornes sur un champ :</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="kw">SELECT</span> tel.DATE_ACHAT <span class="kw">AS</span> dateAchat</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>       , <span class="kw">type</span>.libelle <span class="kw">AS</span> <span class="kw">type</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>       , marq.libelle <span class="kw">AS</span> marque</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>       , tel.PRIX <span class="kw">AS</span> prix</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>       , <span class="cf">CASE</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>            <span class="cf">WHEN</span> tel.PRIX <span class="op">&lt;=</span> <span class="dv">99</span> <span class="cf">THEN</span> <span class="st">&#39;premier Prix&#39;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>            <span class="cf">WHEN</span> tel.PRIX <span class="op">&gt;=</span> <span class="dv">300</span> <span class="cf">THEN</span> <span class="st">&#39;Prix élevé&#39;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>            <span class="cf">WHEN</span> tel.PRIX <span class="op">&gt;</span> <span class="dv">49</span> <span class="kw">AND</span> tel.PRIX <span class="op">&lt;</span> <span class="dv">300</span> <span class="cf">THEN</span> <span class="st">&#39;PRIX MOYEN&#39;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>        <span class="cf">END</span> <span class="kw">AS</span> type_PRIX  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a><span class="kw">FROM</span> TD_telephone <span class="kw">AS</span> tel</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> TD_type_tel <span class="kw">AS</span> <span class="kw">type</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>  <span class="kw">ON</span> tel.type_id   <span class="op">=</span> <span class="kw">type</span>.idType</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a><span class="kw">INNER</span> <span class="kw">JOIN</span>  TD_marque_tel <span class="kw">AS</span> marq</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>  <span class="kw">ON</span> tel.marque_id <span class="op">=</span> marq.idMarque;</span></code></pre></div>
<hr />
<h1 id="exercice"><strong>EXERCICE</strong></h1>
<h2 id="exo-1-démonstration-données-géolocalisées"><em>exo 1 démonstration :</em> données géolocalisées</h2>
<p>– vente d’article (style le bon-coin)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> TD_offre;</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> TD_offre (</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>id_offre  <span class="dt">INT</span>  AUTO_INCREMENT</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>, article_offre <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>, ville <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>, location POINT</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a>, <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_offre)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>);</span></code></pre></div>
<ul>
<li><a href="https://mariadb.com/kb/en/point/" target="_blanck">https://mariadb.com/kb/en/point/</a><br />
</li>
<li><a href="https://mariadb.com/kb/en/st_geomfromtext/" target="_blanck">https://mariadb.com/kb/en/st_geomfromtext/</a><br />
<br></li>
<li>longitude et latitude : <a href="https://www.latlong.net/" target="_blanck">latlong</a> <a href="https://www.coordonnees-gps.f" target="_blanck">coordonnees-gps</a> <br></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_offre <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article1&#39;</span>, <span class="st">&#39;Belfort, Fr&#39;</span>, ST_GEOMFROMTEXT(<span class="st">&#39;POINT(6.862100 47.638770)&#39;</span>));</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_offre <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article2&#39;</span>, <span class="st">&#39;Besancon, Fr&#39;</span>, PointFromText(<span class="st">&#39;POINT(6.025530 47.241268)&#39;</span>));</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_offre <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article3&#39;</span>, <span class="st">&#39;Poitiers&#39;</span>, ST_GeomFromText(<span class="st">&#39;POINT(0.340196 46.580260)&#39;</span>));</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_offre <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article4&#39;</span>, <span class="st">&#39;Montpellier&#39;</span>, ST_GeomFromText(<span class="st">&#39;POINT(3.876734 43.611242)&#39;</span>));</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a><span class="kw">FROM</span> TD_offre;</span></code></pre></div>
<p><a href="https://mariadb.com/kb/en/st_distance_sphere/" target="_blanck">doc mariadb</a> - <a href="https://dev.mysql.com/doc/refman/8.0/en/spatial-aggregate-functions.html" target="_blanck">doc mysql</a> - <a href="https://postgis.net/docs/using_postgis_dbmanagement.html" target="_blanck">doc postgre</a> <br> <code>ST_DISTANCE_SPHERE(g1,g2,[r])</code> <br> par défaut le radius est celui de la terre</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">SELECT</span> ST_DISTANCE_SPHERE( ST_GEOMFROMTEXT(<span class="st">&#39;POINT(6.862100 47.638770)&#39;</span>),TD_offre.location )</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>, <span class="fu">CONCAT</span>(<span class="st">&#39;distance entre BELFORT et &#39;</span>,TD_offre.ville)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="kw">FROM</span> TD_offre;</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a><span class="fu">ROUND</span>( ST_DISTANCE_SPHERE( ST_GEOMFROMTEXT(<span class="st">&#39;POINT(6.862100 47.638770)&#39;</span>),TD_offre.location )<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>, <span class="fu">CONCAT</span>(<span class="st">&#39;distance entre BELFORT et &#39;</span>,TD_offre.ville)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a><span class="kw">FROM</span> TD_offre;</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="kw">SET</span> @distance_max<span class="op">=</span><span class="dv">100</span>;</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="kw">SET</span> @ma_localisation<span class="op">=</span>ST_GEOMFROMTEXT(<span class="st">&#39;POINT(6.862100 47.638770)&#39;</span>);</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a><span class="fu">ROUND</span>( ST_DISTANCE_SPHERE( @ma_localisation,TD_offre.location )<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>, <span class="fu">CONCAT</span>(<span class="st">&#39;distance entre BELFORT et &#39;</span>,TD_offre.ville)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a><span class="kw">FROM</span> TD_offre;</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a><span class="kw">FROM</span> TD_offre</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a><span class="kw">WHERE</span> <span class="fu">ROUND</span>( ST_DISTANCE_SPHERE( @ma_localisation ,TD_offre.location )<span class="op">/</span><span class="dv">1000</span>) <span class="op">&lt;</span> @distance_max;</span></code></pre></div>
<p>possibilité de modéliser un polygon <a href="https://www.data.gouv.fr/fr/datasets/contours-des-departements-francais-issus-d-openstreetmap/" target="_blanck">https://www.data.gouv.fr/fr/datasets/contours-des-departements-francais-issus-d-openstreetmap/</a> <br></p>
<h2 id="exo-2-démonstration-recherche-fulltext"><em>exo 2 démonstration :</em> Recherche fulltext</h2>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-search.html" target="_blanck">https://dev.mysql.com/doc/refman/8.0/en/fulltext-search.html</a> <br> <code>MATCH (col1,col2,...) AGAINST (expr [search_modifier])</code></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> TD_article;</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> TD_article (</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>id_article  <span class="dt">INT</span>  AUTO_INCREMENT</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a>, nom <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a>, description_courte TEXT          <span class="co">-- 65,535 characters</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a>, description_longue MEDIUMTEXT    <span class="co">--  16,777,215 characters </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a>, <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (id_article)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a>, FULLTEXT ft_nom_desc_c_desc_long (nom, description_courte, description_longue)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a>);</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_article <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article1&#39;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="st">tempor incididunt ut labore et dolore magna aliqua. &#39;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a><span class="st">tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a><span class="st">quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a><span class="st">consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a><span class="st">cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a><span class="st">proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&#39;</span>);</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_article <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article2 but&#39;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor sit amet, but consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a><span class="st">tempor incididunt ut labore et dolore but magna aliqua. but 3&#39;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a><span class="st">tempor incididunt ut labore et but  dolore magna aliqua. Ut enim ad minim veniam,</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a><span class="st">quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a><span class="st">consequat. but Duis aute irure dolor in reprehenderit in but voluptate velit esse</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a><span class="st">cillum dolore eu fugiat nulla pariatur. but Excepteur sint occaecat cupidatat non</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a><span class="st">proident, sunt in culpa qui officia deserunt mollit anim id est laborum. but 5&#39;</span>);</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_article <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article1 info&#39;</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor info sit amet, consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true"></a><span class="st">tempor incididunt ut labore et info  dolore magna aliqua. info 3&#39;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true"></a><span class="st">tempor incididunt ut info labore et dolore magna aliqua. Ut enim ad minim veniam,</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true"></a><span class="st">quis nostrud exercitation ullamco laboris nisi info ut aliquip ex ea commodo</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true"></a><span class="st">consequat. Duis aute irure dolor info in reprehenderit in voluptate velit esse</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true"></a><span class="st">cillum dolore eu fugiat nulla pariatur. info Excepteur sint occaecat cupidatat non</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true"></a><span class="st">proident, sunt in culpa qui officia deserunt mollit anim id est laborum. info 5&#39;</span>);</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> TD_article <span class="kw">VALUES</span> (<span class="kw">null</span>, <span class="st">&#39;article1 but info&#39;</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor but info sit amet, consectetur adipisicing elit, but info sed do eiusmod</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true"></a><span class="st">tempor incididunt ut labore but info et dolore magna aliqua. &#39;</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true"></a>, <span class="st">&#39;Lorem ipsum dolor but info sit amet, consectetur adipisicing elit, sed do eiusmod</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true"></a><span class="st">tempor incididunt ut but info labore et dolore magna aliqua. Ut enim ad minim veniam,</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true"></a><span class="st">quis nostrud exercitation ullamco but info laboris nisi ut aliquip ex ea commodo</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true"></a><span class="st">consequat. Duis aute irure dolor in but info reprehenderit in voluptate velit esse</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true"></a><span class="st">cillum dolore eu fugiat nulla pariatur. but info Excepteur sint occaecat cupidatat non</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true"></a><span class="st">proident, sunt in culpa qui officia deserunt mollit anim id est laborum. but info 5&#39;</span>);</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true"></a></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="kw">FROM</span> TD_article;</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> TD_article <span class="kw">ADD</span> FULLTEXT ft_nom (nom);</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> TD_article <span class="kw">ADD</span> FULLTEXT ft_description_courte (description_courte);</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> TD_article <span class="kw">ADD</span> FULLTEXT ft_description_longue (description_longue);</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a>nom,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a>MATCH(nom) AGAINST(<span class="st">&#39;info&#39;</span>)  <span class="kw">AS</span>  score_nom,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a>MATCH(description_courte) AGAINST(<span class="st">&#39;info&#39;</span>) <span class="kw">AS</span> score_description_courte,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a>MATCH(description_longue) AGAINST(<span class="st">&#39;info&#39;</span>) <span class="kw">AS</span> score_description_longue</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a><span class="kw">FROM</span> TD_article;</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true"></a>nom,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true"></a>MATCH(nom) AGAINST(<span class="st">&#39;but info&#39;</span>)  <span class="kw">AS</span>  score_nom,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true"></a>MATCH(description_courte) AGAINST(<span class="st">&#39;but info&#39;</span>) <span class="kw">AS</span> score_description_courte,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true"></a>MATCH(description_longue) AGAINST(<span class="st">&#39;but info&#39;</span>) <span class="kw">AS</span> score_description_longue</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true"></a><span class="kw">FROM</span> TD_article;</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true"></a><span class="kw">SET</span> @recherche_texte<span class="op">=</span><span class="st">&#39;but info&#39;</span>;</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true"></a><span class="kw">SELECT</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true"></a>nom,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true"></a>MATCH(nom) AGAINST(@recherche_texte)  <span class="kw">AS</span>  score_nom ,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true"></a>MATCH(description_courte) AGAINST(@recherche_texte) <span class="kw">AS</span> score_description_courte ,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true"></a>MATCH(description_longue) AGAINST(@recherche_texte) <span class="kw">AS</span> score_description_longue , </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true"></a>MATCH(nom) AGAINST(@recherche_texte) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true"></a><span class="op">+</span> MATCH(description_courte) AGAINST(@recherche_texte) <span class="op">*</span> <span class="fl">0.5</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true"></a><span class="op">+</span> MATCH(description_longue) AGAINST(@recherche_texte) <span class="op">*</span> <span class="fl">0.1</span> <span class="kw">AS</span> calcul_score</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true"></a><span class="kw">FROM</span> TD_article</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true"></a><span class="kw">WHERE</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true"></a>MATCH(nom) AGAINST(@recherche_texte) <span class="kw">OR</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true"></a>MATCH(description_courte) AGAINST(@recherche_texte) <span class="kw">OR</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true"></a>MATCH(description_longue) AGAINST(@recherche_texte)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true"></a><span class="kw">ORDER</span> <span class="kw">BY</span> (score_nom<span class="op">+</span>score_description_courte<span class="op">*</span><span class="fl">0.5</span><span class="op">+</span>score_description_longue<span class="op">*</span><span class="fl">0.1</span>) <span class="kw">DESC</span>;</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true"></a></span></code></pre></div>
<p>plusieurs modes</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/fulltext-natural-language.html" target="_blanck">Natural Language Full-Text Searches</a> - <a href="https://mariadb.com/kb/en/full-text-index-overview/" target="_blanck">mariadb</a>
<ul>
<li>voir exemple ci-dessus</li>
</ul></li>
<li><a href="" target="_blanck">Boolean Full-Text Searches</a></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="kw">SELECT</span> nom </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="kw">FROM</span> TD_article </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="kw">WHERE</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>MATCH (description_courte)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>AGAINST (<span class="st">&#39;+info -but&#39;</span> <span class="kw">IN</span> <span class="dt">BOOLEAN</span> <span class="kw">MODE</span>);</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a><span class="kw">SELECT</span> nom , description_courte</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a><span class="kw">FROM</span> TD_article </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a><span class="kw">WHERE</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a>MATCH (description_courte)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a>AGAINST (<span class="st">&#39;inf*&#39;</span> <span class="kw">IN</span> <span class="dt">BOOLEAN</span> <span class="kw">MODE</span>);</span></code></pre></div>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/fulltext-query-expansion.html" target="_blanck">Full-Text Searches with Query Expansion</a></li>
</ul>
<pre><code>SELECT nom , description_courte
FROM TD_article 
WHERE 
MATCH (description_courte)
AGAINST (&#39;info&#39; WITH QUERY EXPANSION);
</code></pre>
<p>expansion aveugle des requêtes : Cela fonctionne en effectuant la recherche deux fois, où la phrase de recherche pour la deuxième recherche est la phrase de recherche d’origine concaténée avec les quelques documents les plus pertinents de la première recherche.</p>
<!--
<https://runebook.dev/fr/docs/mariadb/fulltext-index-overview/index>{target=_blanck}
<br>
<https://severalnines.com/database-blog/introduction-full-text-search-mariadb>{target=_blanck}
<br>
<https://www.activpart.com/une-introduction-a-la-recherche-full-text-avec-mariadb/>{target=_blanck}
<br>
<https://blog.axe-net.fr/recherche-pertinence-mysql-fulltext/>{target=_blanck}
<br>
<https://blog.axe-net.fr/tuto-mysql-fulltext-in-boolean-mode/>{target=_blanck}
<br>


* <https://blog.axe-net.fr/recherche-pertinence-mysql-fulltext/>{target=_blanck}
* <https://www.mysqltutorial.org/mysql-natural-language-search.aspx>{target=_blanck}
<br>

* <https://database.guide/how-match-against-works-in-mariadb/>{target=_blanck}
<br>
-->
<h2 id="exo-3"><em>exo 3 :</em></h2>
<ul>
<li>Afficher l’identifiant du téléphone, le libellé de la marque, le libellé du type, le prix , la date d’achat et la date limite de garantie des téléphones (1 an rajouté à la date d’achat). Le résultat est ordonné par date d’achat.</li>
</ul>
<pre><code>+-------------+-------------------+------------+--------+------------+-------------------+
| idTelephone | libelle           | libelle    | prix   | date_achat | date_fin_garantie |
+-------------+-------------------+------------+--------+------------+-------------------+
|           7 | société SAMSUNG   | Smartphone | 189.00 | 2013-01-15 | 2014-01-15        |
|           1 | société SAMSUNG   | Smartphone | 139.99 | 2020-01-15 | 2021-01-15        |
|           2 | entreprise SONY   | Smartphone |  99.99 | 2020-03-14 | 2021-03-14        |
|           3 | groupe PHILIPS    | clapet     |  49.11 | 2020-05-02 | 2021-05-02        |
|           4 | marque MOTOROLA   | COULISSANT |  89.14 | 2020-07-25 | 2021-07-25        |
|           5 | SOCIETE APPLE     | IPHONE     | 359.49 | 2020-09-30 | 2021-09-30        |
+-------------+-------------------+------------+--------+------------+-------------------+

</code></pre>
<h2 id="exo-4"><em>exo 4 :</em></h2>
<ul>
<li>Même requête que la précédente mais afficher la date de garantie des téléphones (1 an) sauf pour les téléphones de la marque “SAMSUNG” (2 ans) et “APPLE” (3 ans). Le résultat est ordonné par date d’achat.</li>
</ul>
<pre><code>+-------------+-------------------+------------+--------+------------+-------------------+
|           7 | société SAMSUNG   | Smartphone | 189.00 | 2013-01-15 | 2015-01-15        |
|           1 | société SAMSUNG   | Smartphone | 139.99 | 2020-01-15 | 2022-01-15        |
|           2 | entreprise SONY   | Smartphone |  99.99 | 2020-03-14 | 2021-03-14        |
|           3 | groupe PHILIPS    | clapet     |  49.11 | 2020-05-02 | 2021-05-02        |
|           4 | marque MOTOROLA   | COULISSANT |  89.14 | 2020-07-25 | 2021-07-25        |
|           5 | SOCIETE APPLE     | IPHONE     | 359.49 | 2020-09-30 | 2023-09-30        |
+-------------+-------------------+------------+--------+------------+-------------------+
</code></pre>
<h2 id="exo-5"><em>exo 5:</em></h2>
<ul>
<li><p>Remise : le magasin désire envoyer un bon de remise à toutes les personnes propriétaires d’un téléphone depuis moins de 5 ans (date d’achat datant de moins de 5 ans)</p>
<ul>
<li>le bon de remise s’élève à 10% pour les téléphones de la marque APPLE</li>
<li>le bon de remise s’élève à 7% pour les téléphones de la marque SAMSUNG</li>
<li>le bon de remise s’élève à 5% pour les autres téléphones</li>
</ul></li>
<li><p>le prix doit être non “NULL” ainsi que la date d’achat</p></li>
<li><p>arrondir les valeurs aux chiffres supérieurs</p></li>
<li><p>afficher l’identifiant du propriétaire, le libellé de la marque, le libellé du type, le prix, la date d’achat, le nombre de jours entre aujourd’hui et (la date d’achat + 2 ans). Le résultat est ordonné par date d’achat.</p></li>
<li><p>Modifier une date : “UPDATE TD_telephone SET date_achat=”2006-01-15" WHERE proprietaire_id=190215;" et vérifier que la requête précédente fonctionne bien.</p></li>
</ul>
<pre><code>+-----------------+-------------------+------------+--------+------------+------------+---------+
| proprietaire_id | libelle           | libelle    | prix   | date_achat | calcul_tmp | remise  |
+-----------------+-------------------+------------+--------+------------+------------+---------+
|          190120 | société SAMSUNG   | Smartphone | 139.99 | 2020-01-15 |       -709 |  9.7993 |
|          190215 | entreprise SONY   | Smartphone |  99.99 | 2020-03-14 |       -767 |  4.9995 |
|          190001 | groupe PHILIPS    | clapet     |  49.11 | 2020-05-02 |       -816 |  2.4555 |
|          190222 | marque MOTOROLA   | COULISSANT |  89.14 | 2020-07-25 |       -900 |  4.4570 |
|          190561 | SOCIETE APPLE     | IPHONE     | 359.49 | 2020-09-30 |       -967 | 35.9490 |
+-----------------+-------------------+------------+--------+------------+------------+---------+
</code></pre>
<p><br><br></p>
<h2 id="exo-6concaténation-casting"><em>exo 6:(concaténation, casting)</em></h2>
<p>objectif : mettre les dates au format JJ/MM/AAAA “strict”, faire une recherche sur la fonction LPAD</p>
<pre><code>+-----------------+-------------------+------------+--------+---------------+
| proprietaire_id | libelle           | libelle    | prix   | DATE_ACHAT_FR |
+-----------------+-------------------+------------+--------+---------------+
|          190622 | société SAMSUNG   | Smartphone | 189.00 | 15/01/2013    |
|          190120 | société SAMSUNG   | Smartphone | 139.99 | 15/01/2020    |
|          190215 | entreprise SONY   | Smartphone |  99.99 | 14/03/2020    |
|          190001 | groupe PHILIPS    | clapet     |  49.11 | 02/05/2020    |
|          190222 | marque MOTOROLA   | COULISSANT |  89.14 | 25/07/2020    |
|          190561 | SOCIETE APPLE     | IPHONE     | 359.49 | 30/09/2020    |
+-----------------+-------------------+------------+--------+---------------+
</code></pre>
<h1 id="annexes">ANNEXES</h1>
<p>les variables (voir PL/SQL) <a href="https://docs.oracle.com/cd/E17952_01/mysql-5.7-en/user-variables.html" target="_blanck">https://docs.oracle.com/cd/E17952_01/mysql-5.7-en/user-variables.html</a> <br></p>
<pre><code>SET @t1=1, @t2=2, @t3:=4;
SELECT @t1, @t2, @t3, @t4 := @t1+@t2+@t3;</code></pre>
<ul>
<li>sur oracle</li>
</ul>
<p><a href="https://docs.oracle.com/cd/E11882_01/server.112/e16604/ch_twelve050.htm#SQPUG133" target="_blanck">https://docs.oracle.com/cd/E11882_01/server.112/e16604/ch_twelve050.htm#SQPUG133</a> <br> * sur sqlserver</p>
<p><a href="https://docs.microsoft.com/fr-fr/sql/t-sql/language-elements/variables-transact-sql?view=sql-server-ver15" target="_blanck">https://docs.microsoft.com/fr-fr/sql/t-sql/language-elements/variables-transact-sql?view=sql-server-ver15</a> <br></p>
<ul>
<li>sur postgresql</li>
</ul>
<p><a href="https://docs.postgresql.fr/8.1/plpgsql-declarations.html" target="_blanck">https://docs.postgresql.fr/8.1/plpgsql-declarations.html</a> <a href="https://www.postgresqltutorial.com/plpgsql-variables/" target="_blanck">https://www.postgresqltutorial.com/plpgsql-variables/</a> <br></p>
<p><a href="https://blog.developpez.com/sqlpro/p9136/langage-sql-norme/mysql_un_sgbdr_poudre_aux_yeux">critiques mysql</a></p>
</body>
</html>
